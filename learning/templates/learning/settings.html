{% extends 'base.html' %}

{% load static %}

{% block title %}Settings{% endblock %}

{% block content %}
<div class="container">
    <h1>Settings</h1>
    <p>Here you can manage your settings.</p>

    <!-- Preferences Section -->
    <h2>Preferences</h2>
    <form method="post" action="{% url 'settings' %}">

        {% csrf_token %}

       <!-- Password & Social Accounts -->
<fieldset>
    <legend>Password & Social Accounts</legend>
    <form method="post" action="{% url 'save_password_social_accounts' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="current-password">Current Password:</label>
            <div class="input-group">
                <span class="input-group-icon"><i class="fas fa-lock"></i></span>
                <input type="password" id="current-password" name="current_password" required>
            </div>
        </div>
        <div class="form-group">
            <label for="new-password">New Password:</label>
            <div class="input-group">
                <span class="input-group-icon"><i class="fas fa-key"></i></span>
                <input type="password" id="new-password" name="new_password" required>
            </div>
        </div>
        <div class="form-group">
            <label for="confirm-password">Confirm New Password:</label>
            <div class="input-group">
                <span class="input-group-icon"><i class="fas fa-key"></i></span>
                <input type="password" id="confirm-password" name="confirm_password" required>
            </div>
        </div>
        <div class="form-group">
            <label for="connect-social">Connect Social Accounts:</label>
            <div>
                <!-- <button type="button" onclick="connectSocial('X')" class="social-btn">
                    <i class="fas fa-globe"></i> Connect X
                </button> -->
                <button type="button" onclick="connectSocial('Google')" class="social-btn">
                    <i class="fab fa-google"></i> Connect Google
                </button>
                <button type="button" onclick="connectSocial('Office365')" class="social-btn">
                    <i class="fab fa-microsoft"></i> Connect Office 365/Outlook
                </button>
                <!-- <button type="button" onclick="connectSocial('Apple')" class="social-btn">
                    <i class="fab fa-apple"></i> Connect Apple
                </button> -->
            </div>
        </div>
        <button type="submit">Save Changes</button>
    </form>
</fieldset>

<!-- Time and Language -->
<fieldset>
    <legend>Time and Language</legend>
    <form method="post" action="{% url 'save_time_language' %}">
        {% csrf_token %}
        <div class="form-group">
            <label for="timezone">Timezone:</label>
            <select id="timezone" name="timezone">
                <!-- Timezone options will be populated by JavaScript -->
            </select>
        </div>
        <div class="form-group">
            <label for="time-format">Time Format:</label>
            <select id="time-format" name="time_format">
                <option value="12">12-hour</option>
                <option value="24">24-hour</option>
            </select>
        </div>
        <div class="form-group">
            <label for="week-start">Week Start:</label>
            <select id="week-start" name="week_start">
                <option value="0">Sunday</option>
                <option value="1">Monday</option>
            </select>
        </div>
        <div class="form-group">
            <label for="site-language">Site Language:</label>
            <select id="site-language" name="site_language">
                <!-- Language options will be populated by JavaScript -->
            </select>
        </div>
        <button type="submit">Save Changes</button>
    </form>
</fieldset>

<!-- Notifications -->
<fieldset>
    <legend>Notifications</legend>
    <form method="post" action="{% url 'save_notifications' %}">
        {% csrf_token %}
        <div class="form-group">
            <label><input type="checkbox" name="system_notifications" checked> System Notifications</label>
        </div>
        <div class="form-group">
            <label><input type="checkbox" name="one_click_booking" checked> Booking with One Click</label>
        </div>
        <div class="form-group">
            <label><input type="checkbox" name="next_class_notification" checked> Notification About Next Class</label>
        </div>
        <div class="form-group">
            <label><input type="checkbox" name="email_notifications" checked> E-mail Notifications</label>
        </div>
        <div class="form-group">
            <label><input type="checkbox" name="booked_class_confirmation" checked> Booked Class Confirmation</label>
        </div>
        <div class="form-group">
            <label><input type="checkbox" name="cancelled_class_confirmation" checked> Cancelled Class Confirmation</label>
        </div>
        <div class="form-group">
            <label><input type="checkbox" name="marketing_communications" checked> Marketing Communications</label>
        </div>
        <div class="form-group">
            <label><input type="checkbox" name="class_reminder" checked> Class Reminder</label>
        </div>
        <div class="form-group">
            <label><input type="checkbox" name="weekly_recap" checked> Weekly Recap</label>
        </div>
        <button type="submit">Save Changes</button>
    </form>
</fieldset>

<!-- Calendar Connection -->
<fieldset>
    <legend>Calendar Connection</legend>
    <form method="post" action="{% url 'save_calendar_connection' %}">
        {% csrf_token %}
        <div class="form-group">
            <button type="button" onclick="connectCalendar('Google')" class="calendar-btn">
                <i class="fab fa-google"></i> Connect Google Calendar
            </button>
        </div>
        <div class="form-group">
            <button type="button" onclick="connectCalendar('Office365')" class="calendar-btn">
                <i class="fab fa-microsoft"></i> Connect Office 365/Outlook
            </button>
        </div>
        <button type="submit">Save Changes</button>
    </form>
</fieldset>
    </form>
</div>
<script>
    // Populate timezone select with user's current timezone and others
    function populateTimezones() {
        const timezoneSelect = document.getElementById('timezone');
        const timezones = Intl.supportedValuesOf('timeZone');
        const currentTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;

        timezones.forEach(tz => {
            const option = document.createElement('option');
            option.value = tz;
            option.textContent = tz.replace('_', ' ');
            timezoneSelect.appendChild(option);
        });

        timezoneSelect.value = currentTimezone; // Automatically select current timezone
    }

    // Populate language options
    function populateLanguages() {
        const languageSelect = document.getElementById('site-language');
        const languages = [
            { code: 'en', name: 'English' },
            { code: 'es', name: 'Spanish' },
            { code: 'fr', name: 'French' },
            { code: 'de', name: 'German' },
            { code: 'zh', name: 'Chinese' },
            // Add more languages as needed
        ];

        languages.forEach(lang => {
            const option = document.createElement('option');
            option.value = lang.code;
            option.textContent = lang.name;
            languageSelect.appendChild(option);
        });
    }

    document.addEventListener('DOMContentLoaded', () => {
        populateTimezones();
        populateLanguages();
    });

    // Function to connect to social platforms
    function connectSocial(platform) {
    const redirectURI = encodeURIComponent('https://domain.com'); 
    const googleClientID = '831072126004-651a06d6bmjd4kemgf7lc17d55fs9gk5.apps.googleusercontent.com'; 
    const xClientID = 'cm5LMVRoSkc5bG02cWdkZlJFTWM6MTpjaQ'; 
    const appleClientID = 'your-apple-client-id';
    const Office365 = 'c5da48b5-b65c-45c6-9708-db008d9ab160';

    if (platform === 'Google') {
        window.location.href = `https://accounts.google.com/o/oauth2/auth?client_id=${googleClientID}&redirect_uri=${redirectURI}&response_type=token&scope=profile email`;
    } else if (platform === 'X') {
        window.location.href = `https://x.com/oauth/authorize?client_id=${xClientID}&redirect_uri=${redirectURI}&response_type=token`;
    } else if (platform === 'Apple') {
        window.location.href = `https://appleid.apple.com/auth/authorize?client_id=${appleClientID}&redirect_uri=${redirectURI}&response_type=code`;
    } else if (platform === 'Office365') {
            window.location.href = `https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=${Office365}&redirect_uri=${redirectURI}&response_type=token&scope=offline_access%20https://outlook.office.com/calendars.readwrite`;
        }

}


    // Function to connect to calendar platforms
    function connectCalendar(platform) {
        const redirectURI = encodeURIComponent('https://domain.com'); // Replace with your actual redirect URI
        const googleClientID = '831072126004-651a06d6bmjd4kemgf7lc17d55fs9gk5.apps.googleusercontent.com'; // Replace with your actual client ID
        const Office365 = 'c5da48b5-b65c-45c6-9708-db008d9ab160';

        if (platform === 'Google') {
            window.location.href = `https://accounts.google.com/o/oauth2/auth?client_id=${googleClientID}&redirect_uri=${redirectURI}&response_type=token&scope=profile email`;

        } else if (platform === 'Office365') {
            window.location.href = `https://login.microsoftonline.com/common/oauth2/v2.0/authorize?client_id=${Office365}&redirect_uri=${redirectURI}&response_type=token&scope=offline_access%20https://outlook.office.com/calendars.readwrite`;
        }
    }

    // Displays a loading indicator to the user
    function showLoadingIndicator() {
        document.getElementById('loading-indicator').style.display = 'flex';
    }

    // Hides the loading indicator from the user
    function hideLoadingIndicator() {
        document.getElementById('loading-indicator').style.display = 'none';
    }
</script>

<style>
    /* Styling for input groups and buttons */
    .input-group {
        display: flex;
        align-items: center;
    }
    .input-group-icon {
        padding: 0 10px;
    }
    .input-group input {
        flex: 1;
    }
    .social-btn, .calendar-btn {
        display: inline-flex;
        align-items: center;
        padding: 5px 10px;
        margin: 5px 0;
        cursor: pointer;
        border: 1px solid #ccc;
        ;
    }
    .social-btn i, .calendar-btn i {
        margin-right: 5px;
    }
</style>
{% endblock %}
