{% extends 'base.html' %}

{% load static %}

{% block title %}Welcome{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/welcome.css' %}">
<div class="welcome-container">
    <!-- Profile section -->
    <div class="profile-section animated fade-in-center">
        {% if profile.profile_picture %}
            <img src="{{ profile.profile_picture.url }}" class="profile-picture" alt="Profile Picture">
        {% else %}
            <img src="{% static 'default_profile_picture.jpg' %}" class="profile-picture" alt="Default Profile Picture">
        {% endif %}
        <h1>Welcome, {{ profile.first_name }} {{ profile.last_name }}!</h1>
    </div>

    <!-- Introduction section -->
    <div class="info-section animated fade-in-center">
        <p>We are thrilled to welcome you to our advanced education platform...</p>
        <button onclick="window.location.href='{% url 'english_test' %}'" class="btn">Take the Test</button>
        <button onclick="window.location.href='{% url 'it_test' %}' class="btn">IT Skills Test</button>
        <div class="arrow-container">
            <div class="arrow"></div>
        </div>
    </div>

    <!-- Image section with custom images and animation -->
    <div class="image-section">
        <div class="image-text-pair">
            <div class="image-container animated slide-in-left">
                <img src="{% static 'images/1.jpg' %}" alt="Learning Image 1" class="info-image">
            </div>
            <div class="text-container animated slide-in-right">
                <p>Interactive and adaptive lessons...</p>
            </div>
        </div>
        <!-- More image-text pairs here -->
    </div>
</div>

<!-- Video container with the hidden video element -->
<div id="videoContainer" style="position: relative; display: none;">
    <video id="welcomeVideo" class="fullscreen-video" src="{% static 'vid/je.mp4' %}" playsinline muted></video>
    <button id="skipButton" class="btn" style="position: absolute; top: 20px; right: 20px; display: none;">Skip Video</button>
</div>

<!-- JavaScript to handle video playback and animations -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const videoContainer = document.getElementById('videoContainer');
        const video = document.getElementById('welcomeVideo');
        const skipButton = document.getElementById('skipButton');
        const hasWatchedVideo = localStorage.getItem('hasWatchedVideo');

        function playVideo() {
            videoContainer.style.display = 'block';  // Show the video container
            video.play();  // Play the video with sound
            skipButton.style.display = 'block'; // Show the skip button

            // Once the video ends, hide it and mark it as watched
            video.onended = function () {
                videoContainer.style.display = 'none'; // Hide the video container
                skipButton.style.display = 'none'; // Hide the skip button
                localStorage.setItem('hasWatchedVideo', 'true');  // Store in localStorage to play only once
            };
        }

        // Skip video function
        skipButton.addEventListener('click', function() {
            video.pause(); // Pause the video
            videoContainer.style.display = 'none'; // Hide the video container
            skipButton.style.display = 'none'; // Hide the skip button
            localStorage.setItem('hasWatchedVideo', 'true'); // Mark as watched
        });

        // Check if the video has been watched before
        if (!hasWatchedVideo) {
            document.addEventListener('click', function() {
                playVideo(); // Start playing the video on first click
                document.removeEventListener('click', arguments.callee); // Remove the listener after first click
            });
        }

        const animatedElements = document.querySelectorAll('.animated');

        function checkScroll() {
            animatedElements.forEach(element => {
                const position = element.getBoundingClientRect().top;
                const screenPosition = window.innerHeight / 1.4;

                if (position < screenPosition) {
                    element.classList.add('show');
                }
            });
        }

        window.addEventListener('scroll', checkScroll);
        checkScroll(); // Run on page load
    });
</script>

{% endblock %}
